{"version":3,"file":"node-build.mjs","sources":["../../server/routes/demo.ts","../../server/routes/coach.ts","../../server/index.ts","../../server/node-build.ts"],"sourcesContent":["import { RequestHandler } from \"express\";\nimport { DemoResponse } from \"@shared/api\";\n\nexport const handleDemo: RequestHandler = (req, res) => {\n  const response: DemoResponse = {\n    message: \"Hello from Express server\",\n  };\n  res.status(200).json(response);\n};\n","import type { RequestHandler } from \"express\";\r\n\r\nexport const handleCoach: RequestHandler = async (req, res) => {\r\n  try {\r\n    const { message } = req.body as { message?: string };\r\n    if (!message || typeof message !== \"string\") {\r\n      return res.status(400).json({ error: \"Missing message\" });\r\n    }\r\n\r\n    // If no API key, return a graceful fallback\r\n    const apiKey = process.env.OPENAI_API_KEY;\r\n    if (!apiKey) {\r\n      return res.json({ reply: \"AI is not configured yet. Please set OPENAI_API_KEY on the server.\" });\r\n    }\r\n\r\n    // Call OpenAI Chat Completions (Node 18+ has global fetch)\r\n    const response = await fetch(\"https://api.openai.com/v1/chat/completions\", {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Authorization\": `Bearer ${apiKey}`,\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: JSON.stringify({\r\n        model: \"gpt-4\",\r\n        messages: [\r\n          { role: \"system\", content: \"You are FinWise AI Coach. Answer concisely about personal finance. Currency is INR by default.\" },\r\n          { role: \"user\", content: message },\r\n        ],\r\n        temperature: 0.2,\r\n      }),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const text = await response.text();\r\n      return res.status(500).json({ error: \"AI provider error\", details: text.slice(0, 2000) });\r\n    }\r\n    const data = await response.json();\r\n    const reply = data.choices?.[0]?.message?.content ?? \"Sorry, I couldn't generate a reply.\";\r\n    return res.json({ reply });\r\n  } catch (error: any) {\r\n    return res.status(500).json({ error: \"Server error\", details: error?.message });\r\n  }\r\n};\r\n\r\n\r\n","import \"dotenv/config\";\nimport express from \"express\";\nimport cors from \"cors\";\nimport { handleDemo } from \"./routes/demo\";\nimport { handleCoach } from \"./routes/coach\";\n\nexport function createServer() {\n  const app = express();\n\n  // Middleware\n  app.use(cors());\n  app.use(express.json());\n  app.use(express.urlencoded({ extended: true }));\n\n  // API routes\n  const router = express.Router();\n  \n  router.get(\"/ping\", (_req, res) => {\n    const ping = process.env.PING_MESSAGE ?? \"ping\";\n    res.json({ message: ping });\n  });\n\n  router.get(\"/demo\", handleDemo);\n  router.post(\"/coach\", handleCoach);\n  \n  // Mount all API routes under /api\n  app.use(\"/api\", router);\n\n  return app;\n}\n","import path from \"path\";\nimport { createServer } from \"./index\";\nimport * as express from \"express\";\n\nconst app = createServer();\nconst port = process.env.PORT || 3000;\n\n// In production, serve the built SPA files\nconst __dirname = import.meta.dirname;\nconst distPath = path.join(__dirname, \"../spa\");\n\n// Serve static files\napp.use(express.static(distPath));\n\n// Handle React Router - serve index.html for all non-API routes\napp.use((req, res, next) => {\n  if (req.method === 'GET' && !req.path.startsWith('/api/') && !req.path.startsWith('/health')) {\n    return res.sendFile(path.join(distPath, \"index.html\"));\n  }\n  next();\n});\n\napp.listen(port, () => {\n  console.log(`ðŸš€ Fusion Starter server running on port ${port}`);\n  console.log(`ðŸ“± Frontend: http://localhost:${port}`);\n  console.log(`ðŸ”§ API: http://localhost:${port}/api`);\n});\n\n// Graceful shutdown\nprocess.on(\"SIGTERM\", () => {\n  console.log(\"ðŸ›‘ Received SIGTERM, shutting down gracefully\");\n  process.exit(0);\n});\n\nprocess.on(\"SIGINT\", () => {\n  console.log(\"ðŸ›‘ Received SIGINT, shutting down gracefully\");\n  process.exit(0);\n});\n"],"names":["app","express"],"mappings":"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"}